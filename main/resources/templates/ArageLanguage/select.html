<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Draggable Language Switcher</title>-->
<!--    <style>-->
<!--        /* Keep all existing styles unchanged */-->
<!--        .lang-switcher {-->
<!--            position: fixed;-->
<!--            z-index: 9999;-->
<!--            cursor: move;-->
<!--            transition: all 0.5s ease-out;-->
<!--        }-->
<!--        .lang-toggle {-->
<!--            width: 50px;-->
<!--            height: 50px;-->
<!--            border: none;-->
<!--            border-radius: 50%;-->
<!--            padding: 0;-->
<!--            cursor: pointer;-->
<!--            background: transparent;-->
<!--        }-->
<!--        .lang-toggle img {-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            border-radius: 50%;-->
<!--            box-shadow: 0 2px 6px rgba(0,0,0,0.2);-->
<!--            transition: transform 0.3s ease;-->
<!--        }-->
<!--        .lang-toggle:hover img {-->
<!--            transform: scale(1.05);-->
<!--        }-->
<!--        .lang-options {-->
<!--            display: none;-->
<!--            position: absolute;-->
<!--            bottom: 60px;-->
<!--            left: 50%;-->
<!--            transform: translateX(-50%);-->
<!--            background: white;-->
<!--            border-radius: 6px;-->
<!--            box-shadow: 0 2px 8px rgba(0,0,0,0.15);-->
<!--            min-width: 100px;-->
<!--            overflow: hidden;-->
<!--        }-->
<!--        .lang-option {-->
<!--            width: 100%;-->
<!--            padding: 8px 12px;-->
<!--            border: none;-->
<!--            background: none;-->
<!--            text-align: center;-->
<!--            cursor: pointer;-->
<!--            transition: background 0.2s ease;-->
<!--        }-->
<!--        .lang-option:hover {-->
<!--            background: #f0f0f0;-->
<!--        }-->
<!--        @keyframes bounceBottom {-->
<!--            0%, 100% { transform: translateY(0); }-->
<!--            30% { transform: translateY(-30px); }-->
<!--            60% { transform: translateY(-10px); }-->
<!--        }-->
<!--        @keyframes bounceSideMiddle {-->
<!--            0%, 100% { transform: translateY(0); }-->
<!--            30% { transform: translateY(30px); }-->
<!--            60% { transform: translateY(10px); }-->
<!--        }-->
<!--        .bounce-bottom {-->
<!--            animation: bounceBottom 0.8s ease-in-out;-->
<!--        }-->
<!--        .bounce-side-middle {-->
<!--            animation: bounceSideMiddle 0.8s ease-in-out;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--&lt;!&ndash; Draggable Language Switcher (keep HTML structure unchanged) &ndash;&gt;-->
<!--<div class="lang-switcher">-->
<!--    <div class="lang-options">-->
<!--        <button class="lang-option" data-lang="en">English</button>-->
<!--        <button class="lang-option" data-lang="zh">中文</button>-->
<!--        <button class="lang-option" data-lang="de">Deutsch</button>-->
<!--        <button class="lang-option" data-lang="sw">Swahili</button>-->
<!--        <button class="lang-option" data-lang="fr-CA">Canadian French</button>-->
<!--    </div>-->
<!--    <button class="lang-toggle">-->
<!--        <img src="/Arage/panda.jpg" alt="Language switch"> &lt;!&ndash; Fix image path to absolute &ndash;&gt;-->
<!--    </button>-->
<!--</div>-->

<!--<script>-->
<!--    // Keep all existing draggable/bounce logic unchanged-->
<!--    const switcher = document.querySelector('.lang-switcher');-->
<!--    const toggle = document.querySelector('.lang-toggle');-->
<!--    const options = document.querySelector('.lang-options');-->
<!--    const langButtons = document.querySelectorAll('.lang-option');-->
<!--    let isDragging = false;-->
<!--    let offsetX, offsetY;-->
<!--    let autoMoveTimer = null;-->
<!--    let jumpTimer = null;-->
<!--    const AUTO_MOVE_DELAY = 3000;-->
<!--    const JUMP_DELAY = 4000;-->
<!--    const bounceClasses = {-->
<!--        bottom: 'bounce-bottom',-->
<!--        sideMiddle: 'bounce-side-middle'-->
<!--    };-->

<!--    // Initialize position (unchanged)-->
<!--    function setInitialPosition() {-->
<!--        const windowWidth = window.innerWidth;-->
<!--        const windowHeight = window.innerHeight;-->
<!--        const switcherWidth = switcher.offsetWidth;-->
<!--        const startOnLeft = Math.random() > 0.5;-->
<!--        let targetX = startOnLeft ? 10 : windowWidth - switcherWidth - 10;-->
<!--        const targetY = (windowHeight - 50) / 2;-->
<!--        switcher.style.left = `${targetX}px`;-->
<!--        switcher.style.top = `${targetY}px`;-->
<!--        resetAllTimers();-->
<!--    }-->

<!--    // Get position type (unchanged)-->
<!--    function getCurrentPositionType() {-->
<!--        const rect = switcher.getBoundingClientRect();-->
<!--        const windowHeight = window.innerHeight;-->
<!--        const windowWidth = window.innerWidth;-->
<!--        const marginSide = 50;-->
<!--        const marginBottom = 50;-->
<!--        const isBottom = (windowHeight - rect.bottom) <= marginBottom;-->
<!--        const isLeftSide = rect.left <= marginSide;-->
<!--        const isRightSide = rect.right >= windowWidth - marginSide;-->
<!--        const isSideMiddle = (isLeftSide || isRightSide) && !isBottom;-->
<!--        if (isBottom) return 'bottom';-->
<!--        if (isSideMiddle) return 'sideMiddle';-->
<!--        return null;-->
<!--    }-->

<!--    // Perform bounce (unchanged)-->
<!--    function performBounceAnimation() {-->
<!--        const positionType = getCurrentPositionType();-->
<!--        if (!positionType) {-->
<!--            jumpTimer = setTimeout(performBounceAnimation, JUMP_DELAY);-->
<!--            return;-->
<!--        }-->
<!--        Object.values(bounceClasses).forEach(cls => switcher.classList.remove(cls));-->
<!--        void switcher.offsetWidth;-->
<!--        switcher.classList.add(bounceClasses[positionType]);-->
<!--        const animDuration = parseFloat(getComputedStyle(switcher).animationDuration) * 1000;-->
<!--        setTimeout(() => switcher.classList.remove(bounceClasses[positionType]), animDuration);-->
<!--        jumpTimer = setTimeout(performBounceAnimation, JUMP_DELAY);-->
<!--    }-->

<!--    // Reset timers (unchanged)-->
<!--    function resetAllTimers() {-->
<!--        if (autoMoveTimer) clearTimeout(autoMoveTimer);-->
<!--        if (jumpTimer) clearTimeout(jumpTimer);-->
<!--        autoMoveTimer = setTimeout(() => {-->
<!--            const rect = switcher.getBoundingClientRect();-->
<!--            const centerX = rect.left + rect.width / 2;-->
<!--            const windowWidth = window.innerWidth;-->
<!--            const closestSide = centerX < windowWidth / 2 ? 'left' : 'right';-->
<!--            const targetX = closestSide === 'left' ? 10 : windowWidth - rect.width - 10;-->
<!--            const targetY = Math.max(10, Math.min(rect.top, window.innerHeight - rect.height - 10));-->
<!--            switcher.style.left = `${targetX}px`;-->
<!--            switcher.style.top = `${targetY}px`;-->
<!--            resetAllTimers();-->
<!--        }, AUTO_MOVE_DELAY);-->
<!--        jumpTimer = setTimeout(performBounceAnimation, JUMP_DELAY);-->
<!--    }-->

<!--    // Drag handlers (unchanged)-->
<!--    function startDrag(e) {-->
<!--        e.preventDefault();-->
<!--        isDragging = true;-->
<!--        const rect = switcher.getBoundingClientRect();-->
<!--        offsetX = (e.type === 'mousedown' ? e.clientX : e.touches[0].clientX) - rect.left;-->
<!--        offsetY = (e.type === 'mousedown' ? e.clientY : e.touches[0].clientY) - rect.top;-->
<!--        switcher.style.transition = 'none';-->
<!--        Object.values(bounceClasses).forEach(cls => switcher.classList.remove(cls));-->
<!--        resetAllTimers();-->
<!--    }-->
<!--    function drag(e) {-->
<!--        if (!isDragging) return;-->
<!--        const clientX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;-->
<!--        const clientY = e.type === 'mousemove' ? e.clientY : e.touches[0].clientY;-->
<!--        const constrainedX = Math.max(0, Math.min(clientX - offsetX, window.innerWidth - switcher.offsetWidth));-->
<!--        const constrainedY = Math.max(0, Math.min(clientY - offsetY, window.innerHeight - switcher.offsetHeight));-->
<!--        switcher.style.left = `${constrainedX}px`;-->
<!--        switcher.style.top = `${constrainedY}px`;-->
<!--    }-->
<!--    function endDrag() {-->
<!--        if (isDragging) {-->
<!--            isDragging = false;-->
<!--            switcher.style.transition = 'all 0.5s ease-out';-->
<!--            resetAllTimers();-->
<!--        }-->
<!--    }-->

<!--    // &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
<!--    // Modified: Language Switch Logic (Call Controller Instead of Local Translation)-->
<!--    // &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-->
<!--    // Toggle options display (unchanged)-->
<!--    toggle.addEventListener('mouseenter', () => { options.style.display = 'block'; resetAllTimers(); });-->
<!--    toggle.addEventListener('touchstart', () => { options.style.display = 'block'; resetAllTimers(); });-->
<!--    document.addEventListener('click', (e) => { if (!switcher.contains(e.target)) options.style.display = 'none'; });-->

<!--    // Update language switch to call controller-->
<!--    langButtons.forEach(btn => {-->
<!--        btn.addEventListener('click', () => {-->
<!--            const lang = btn.dataset.lang;-->
<!--            // Redirect to ArageController's switch-lang mapping-->
<!--            window.location.href = `/arage/switch-lang?lang=${lang}`;-->
<!--            options.style.display = 'none';-->
<!--        });-->
<!--    });-->

<!--    // Window resize (unchanged)-->
<!--    window.addEventListener('resize', () => {-->
<!--        const rect = switcher.getBoundingClientRect();-->
<!--        const constrainedX = Math.max(0, Math.min(rect.left, window.innerWidth - rect.width));-->
<!--        const constrainedY = Math.max(0, Math.min(rect.top, window.innerHeight - rect.height));-->
<!--        switcher.style.left = `${constrainedX}px`;-->
<!--        switcher.style.top = `${constrainedY}px`;-->
<!--        resetAllTimers();-->
<!--    });-->

<!--    // Drag event listeners (unchanged)-->
<!--    switcher.addEventListener('mousedown', startDrag);-->
<!--    document.addEventListener('mousemove', drag);-->
<!--    document.addEventListener('mouseup', endDrag);-->
<!--    switcher.addEventListener('touchstart', startDrag);-->
<!--    document.addEventListener('touchmove', drag);-->
<!--    document.addEventListener('touchend', endDrag);-->

<!--    // Initialize (unchanged)-->
<!--    setInitialPosition();-->
<!--</script>-->
<!--</body>-->
<!--</html>-->



<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draggable Language Switcher</title>
    <style>
        /* Draggable container */
        .lang-switcher {
            position: fixed;
            z-index: 9999;
            cursor: move;
            transition: all 0.5s ease-out;
        }

        /* Toggle icon */
        .lang-toggle {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            padding: 0;
            cursor: pointer;
            background: transparent;
        }

        .lang-toggle img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .lang-toggle:hover img {
            transform: scale(1.05);
        }

        /* Language options */
        .lang-options {
            display: none;
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            min-width: 100px;
            overflow: hidden;
        }

        .lang-option {
            width: 100%;
            padding: 8px 12px;
            border: none;
            background: none;
            text-align: center;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .lang-option:hover {
            background: #f0f0f0;
        }

        /* TARGETED BOUNCE ANIMATIONS */
        /* 1. For Bottom Position: Up → Down → Original */
        @keyframes bounceBottom {
            0%, 100% { transform: translateY(0); }
            30% { transform: translateY(-30px); }
            60% { transform: translateY(-10px); }
        }

        /* 2. For Left/Right Middle Position: Down → Up → Original */
        @keyframes bounceSideMiddle {
            0%, 100% { transform: translateY(0); }
            30% { transform: translateY(30px); }
            60% { transform: translateY(10px); }
        }

        /* Animation Classes */
        .bounce-bottom {
            animation: bounceBottom 0.8s ease-in-out;
        }

        .bounce-side-middle {
            animation: bounceSideMiddle 0.8s ease-in-out;
        }

        /* Example content */
        .content [data-i18n] {
            margin: 20px;
        }
    </style>
</head>
<body>
<!-- Draggable Language Switcher -->
<div class="lang-switcher">
    <div class="lang-options">
        <button class="lang-option" data-lang="en">English</button>
        <button class="lang-option" data-lang="zh">中文</button>
        <button class="lang-option" data-lang="de">Deutsch</button>
        <button class="lang-option" data-lang="sw">Swahili</button>
        <button class="lang-option" data-lang="fr-CA">Canadian French</button>
    </div>
    <button class="lang-toggle">
        <img src="/Arage/panda.jpg" alt="Language switch"> <!-- Ensure image path is correct -->
    </button>
</div>




<script>
    // DOM Elements
    const switcher = document.querySelector('.lang-switcher');
    const toggle = document.querySelector('.lang-toggle');
    const options = document.querySelector('.lang-options');
    const langButtons = document.querySelectorAll('.lang-option');

    // State variables
    let isDragging = false;
    let offsetX, offsetY;
    let autoMoveTimer = null;
    let jumpTimer = null;
    const AUTO_MOVE_DELAY = 3000; // 3 seconds
    const JUMP_DELAY = 4000; // 4-second bounce interval

    // Animation class mapping
    const bounceClasses = {
        bottom: 'bounce-bottom',
        sideMiddle: 'bounce-side-middle'
    };

    // Initialize position
    function setInitialPosition() {
        const windowWidth = window.innerWidth;
        const windowHeight = window.innerHeight;
        const switcherWidth = switcher.offsetWidth;
        const startOnLeft = Math.random() > 0.5;

        let targetX = startOnLeft ? 10 : windowWidth - switcherWidth - 10;
        const targetY = (windowHeight - 50) / 2;

        switcher.style.left = `${targetX}px`;
        switcher.style.top = `${targetY}px`;
        resetAllTimers();
    }

    // Get current position type
    function getCurrentPositionType() {
        const rect = switcher.getBoundingClientRect();
        const windowHeight = window.innerHeight;
        const windowWidth = window.innerWidth;
        const marginSide = 50;
        const marginBottom = 50;

        const isBottom = (windowHeight - rect.bottom) <= marginBottom;
        const isLeftSide = rect.left <= marginSide;
        const isRightSide = rect.right >= windowWidth - marginSide;
        const isSideMiddle = (isLeftSide || isRightSide) && !isBottom;

        if (isBottom) return 'bottom';
        if (isSideMiddle) return 'sideMiddle';
        return null;
    }

    // Perform bounce animation
    function performBounceAnimation() {
        const positionType = getCurrentPositionType();
        if (!positionType) {
            jumpTimer = setTimeout(performBounceAnimation, JUMP_DELAY);
            return;
        }

        Object.values(bounceClasses).forEach(cls => {
            switcher.classList.remove(cls);
        });

        void switcher.offsetWidth;

        const targetClass = bounceClasses[positionType];
        switcher.classList.add(targetClass);

        const animDuration = parseFloat(getComputedStyle(switcher).animationDuration) * 1000;
        setTimeout(() => {
            switcher.classList.remove(targetClass);
        }, animDuration);

        jumpTimer = setTimeout(performBounceAnimation, JUMP_DELAY);
    }

    // Reset timers
    function resetAllTimers() {
        if (autoMoveTimer) clearTimeout(autoMoveTimer);
        if (jumpTimer) clearTimeout(jumpTimer);

        autoMoveTimer = setTimeout(() => {
            const rect = switcher.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const windowWidth = window.innerWidth;
            const closestSide = centerX < windowWidth / 2 ? 'left' : 'right';
            const targetX = closestSide === 'left' ? 10 : windowWidth - rect.width - 10;
            const targetY = Math.max(10, Math.min(rect.top, window.innerHeight - rect.height - 10));

            switcher.style.left = `${targetX}px`;
            switcher.style.top = `${targetY}px`;
            resetAllTimers();
        }, AUTO_MOVE_DELAY);

        jumpTimer = setTimeout(performBounceAnimation, JUMP_DELAY);
    }

    // Drag handlers
    function startDrag(e) {
        e.preventDefault();
        isDragging = true;
        const rect = switcher.getBoundingClientRect();
        if (e.type === 'mousedown') {
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
        } else {
            offsetX = e.touches[0].clientX - rect.left;
            offsetY = e.touches[0].clientY - rect.top;
        }
        switcher.style.transition = 'none';
        Object.values(bounceClasses).forEach(cls => {
            switcher.classList.remove(cls);
        });
        resetAllTimers();
    }

    function drag(e) {
        if (!isDragging) return;
        let clientX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
        let clientY = e.type === 'mousemove' ? e.clientY : e.touches[0].clientY;
        const windowWidth = window.innerWidth;
        const windowHeight = window.innerHeight;
        const switcherWidth = switcher.offsetWidth;
        const switcherHeight = switcher.offsetHeight;

        const constrainedX = Math.max(0, Math.min(clientX - offsetX, windowWidth - switcherWidth));
        const constrainedY = Math.max(0, Math.min(clientY - offsetY, windowHeight - switcherHeight));

        switcher.style.left = `${constrainedX}px`;
        switcher.style.top = `${constrainedY}px`;
    }

    function endDrag() {
        if (!isDragging) return;
        isDragging = false;
        switcher.style.transition = 'all 0.5s ease-out';
        resetAllTimers();
    }

    // Language switch logic
    toggle.addEventListener('mouseenter', () => {
        options.style.display = 'block';
        resetAllTimers();
    });

    toggle.addEventListener('touchstart', () => {
        options.style.display = 'block';
        resetAllTimers();
    });

    document.addEventListener('click', (e) => {
        if (!switcher.contains(e.target)) options.style.display = 'none';
    });

    langButtons.forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.dataset.lang;
            // Redirect to ArageController's switch-lang mapping
            window.location.href = `/arage/switch-lang?lang=${lang}`;
            options.style.display = 'none';
        });
    });

    // Window resize handling
    window.addEventListener('resize', () => {
        const rect = switcher.getBoundingClientRect();
        const constrainedX = Math.max(0, Math.min(rect.left, window.innerWidth - rect.width));
        const constrainedY = Math.max(0, Math.min(rect.top, window.innerHeight - rect.height));
        switcher.style.left = `${constrainedX}px`;
        switcher.style.top = `${constrainedY}px`;
        resetAllTimers();
    });

    // Drag event listeners
    switcher.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', endDrag);
    switcher.addEventListener('touchstart', startDrag);
    document.addEventListener('touchmove', drag);
    document.addEventListener('touchend', endDrag);

    // Initialize
    setInitialPosition();

    // 👇 Added: Highlight current language
    const currentLang = /*[[${currentLang}]]*/ 'en'; // Get from Thymeleaf model
    langButtons.forEach(btn => {
        if (btn.dataset.lang === currentLang) {
            btn.style.backgroundColor = '#f0f0f0'; // Highlight style
            btn.style.fontWeight = '500'; // Bolder text
        }
    });
</script>
</body>
</html>